@page
@model LoginModel

@{
    ViewData["Title"] = "Iniciar Sesión";
}

<div class="container">
    <div class="row justify-content-center" style="margin-top: 100px;">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <h2 class="fw-bold">The Bury Project</h2>
                        <p class="text-muted">Inicia sesión para continuar</p>
                    </div>

                    <form id="account" method="post">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                        
                        <div class="mb-3">
                            <label asp-for="Input.Email" class="form-label">Email</label>
                            <input asp-for="Input.Email" class="form-control form-control-lg" autocomplete="username" placeholder="correo@ejemplo.com" />
                            <span asp-validation-for="Input.Email" class="text-danger small"></span>
                        </div>
                        
                        <div class="mb-3">
                            <label asp-for="Input.Password" class="form-label">Contraseña</label>
                            <input asp-for="Input.Password" class="form-control form-control-lg" autocomplete="current-password" placeholder="••••••••" />
                            <span asp-validation-for="Input.Password" class="text-danger small"></span>
                        </div>
                        
                        <div class="mb-3 form-check">
                            <input asp-for="Input.RememberMe" class="form-check-input" />
                            <label asp-for="Input.RememberMe" class="form-check-label">
                                Recordarme
                            </label>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">Iniciar Sesión</button>
                        </div>
                        
                        <div class="mt-3 text-center">
                            <a asp-page="./ForgotPassword" class="text-decoration-none">¿Olvidaste tu contraseña?</a>
                        </div>
                    </form>

                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <div class="alert alert-info mt-3">
                            <strong>Debug:</strong> Ya estás autenticado como @User.Identity.Name
                            <form method="post" asp-area="Identity" asp-page="/Account/Logout" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-link">Cerrar sesión</button>
                            </form>
                        </div>
                    }
                </div>
            </div>
            
            <div class="text-center mt-3">
                <small class="text-muted">
                    <strong>Usuarios de prueba:</strong><br />
                    admin@thebury.com / Admin123!<br />
                    test1@test1.com / Pepito123!
                </small>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Auto-focus en el campo de email
        document.querySelector('input[type="email"]')?.focus();
        
        // Log para diagnóstico
        console.log('Página de login cargada');
        document.querySelector('form').addEventListener('submit', function(e) {
            console.log('Formulario enviado:', {
                email: document.querySelector('input[type="email"]').value,
                hasPassword: document.querySelector('input[type="password"]').value.length > 0
            });
        });
    </script>
}
