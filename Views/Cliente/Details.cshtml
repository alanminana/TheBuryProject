@model TheBuryProject.ViewModels.ClienteViewModel

@{
    ViewData["Title"] = "Detalles del Cliente";
}

<div class="container-fluid py-4 text-light">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold">
                    <i class="bi bi-person text-primary"></i> @Model.NombreCompleto
                </h2>
                <div class="d-flex gap-2 flex-wrap">
                    @if (Model.Activo)
                    {
                        <a asp-controller="Credito" asp-action="Create" asp-route-clienteId="@Model.Id" class="btn btn-success">
                            <i class="bi bi-cash-coin"></i> Solicitar Crédito
                        </a>
                    }
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
                        <i class="bi bi-pencil"></i> Editar
                    </a>
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Volver
                    </a>
                </div>
            </div>

            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle"></i> @TempData["Success"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <!-- Indicadores principales -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card bg-dark border-success shadow-sm h-100">
                        <div class="card-body text-center">
                            <h6 class="text-secondary">Estado</h6>
                            <h3>
                                @if (Model.Activo)
                                {
                                    <span class="badge bg-success fs-5">Activo</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary fs-5">Inactivo</span>
                                }
                            </h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-dark border-info shadow-sm h-100">
                        <div class="card-body text-center">
                            <h6 class="text-secondary">Puntaje de Riesgo</h6>
                            @{
                                var badgeClass = Model.PuntajeRiesgo >= 7 ? "bg-success" :
                                Model.PuntajeRiesgo >= 4 ? "bg-warning" : "bg-danger";
                            }
                            <h3><span class="badge @badgeClass fs-4">@Model.PuntajeRiesgo.ToString("F1")</span></h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-dark border-primary shadow-sm h-100">
                        <div class="card-body text-center">
                            <h6 class="text-secondary">Créditos Activos</h6>
                            <h3><span class="badge bg-primary fs-4">@Model.CreditosActivos</span></h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-dark @(Model.TotalAdeudado > 0 ? "border-danger" : "border-success") shadow-sm h-100">
                        <div class="card-body text-center">
                            <h6 class="text-secondary">Total Adeudado</h6>
                            <h3 class="@(Model.TotalAdeudado > 0 ? "text-danger" : "text-success")">
                                @Model.TotalAdeudado.ToString("C")
                            </h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Datos Personales -->
            <div class="card bg-dark border-secondary shadow-sm mb-3">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-person"></i> Datos Personales</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Tipo de Documento</label>
                            <p class="fw-bold">@Model.TipoDocumento</p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Número de Documento</label>
                            <p class="fw-bold">@Model.NumeroDocumento</p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Fecha de Nacimiento</label>
                            <p class="fw-bold">
                                @if (Model.FechaNacimiento.HasValue)
                                {
                                    @Model.FechaNacimiento.Value.ToString("dd/MM/yyyy")
                                    @if (Model.Edad.HasValue)
                                    {
                                        <span class="text-secondary">(@Model.Edad años)</span>
                                    }
                                }
                                else
                                {
                                    <span class="text-secondary">No especificada</span>
                                }
                            </p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Estado Civil</label>
                            <p class="fw-bold">@(Model.EstadoCivil ?? "-")</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Datos de Contacto -->
            <div class="card bg-dark border-secondary shadow-sm mb-3">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-telephone"></i> Datos de Contacto</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Teléfono</label>
                            <p class="fw-bold"><i class="bi bi-telephone"></i> @Model.Telefono</p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Teléfono Alternativo</label>
                            <p class="fw-bold">
                                @if (!string.IsNullOrEmpty(Model.TelefonoAlternativo))
                                {
                                    <i class="bi bi-telephone"></i> 
                                    @Model.TelefonoAlternativo
                                }
                                else
                                {
                                    <span class="text-secondary">-</span>
                                }
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="text-secondary small fw-semibold">Email</label>
                            <p class="fw-bold">
                                @if (!string.IsNullOrEmpty(Model.Email))
                                {
                                    <i class="bi bi-envelope"></i>
                                    <a href="mailto:@Model.Email" class="text-info">@Model.Email</a>
                                }
                                else
                                {
                                    <span class="text-secondary">-</span>
                                }
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Domicilio -->
            <div class="card bg-dark border-secondary shadow-sm mb-3">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-geo-alt"></i> Domicilio</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="text-secondary small fw-semibold">Dirección</label>
                            <p class="fw-bold"><i class="bi bi-house"></i> @Model.Domicilio</p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Localidad</label>
                            <p class="fw-bold">@(Model.Localidad ?? "-")</p>
                        </div>
                        <div class="col-md-2">
                            <label class="text-secondary small fw-semibold">Provincia</label>
                            <p class="fw-bold">@(Model.Provincia ?? "-")</p>
                        </div>
                        <div class="col-md-1">
                            <label class="text-secondary small fw-semibold">CP</label>
                            <p class="fw-bold">@(Model.CodigoPostal ?? "-")</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Datos Laborales -->
            <div class="card bg-dark border-secondary shadow-sm mb-3">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="bi bi-briefcase"></i> Datos Laborales</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="text-secondary small fw-semibold">Empleador</label>
                            <p class="fw-bold">@(Model.Empleador ?? "-")</p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Tipo de Empleo</label>
                            <p class="fw-bold">@(Model.TipoEmpleo ?? "-")</p>
                        </div>
                        <div class="col-md-2">
                            <label class="text-secondary small fw-semibold">Sueldo</label>
                            <p class="fw-bold">
                                @if (Model.Sueldo.HasValue)
                                {
                                    @Model.Sueldo.Value.ToString("C")
                                }
                                else
                                {
                                    <span class="text-secondary">-</span>
                                }
                            </p>
                        </div>
                        <div class="col-md-3">
                            <label class="text-secondary small fw-semibold">Teléfono Laboral</label>
                            <p class="fw-bold">@(Model.TelefonoLaboral ?? "-")</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentación -->
            <div class="card bg-dark border-secondary shadow-sm mb-3">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Documentación Presentada</h5>
                </div>
                <div class="card-body">
                    <div class="row row-cols-1 row-cols-md-3 g-2">
                        <div class="col">
                            @((Model.TieneReciboSueldo) ?
                                                        Html.Raw("<i class='bi bi-check-circle-fill text-success'></i> <strong>Recibo de Sueldo</strong>") :
                                                        Html.Raw("<i class='bi bi-x-circle text-muted'></i> <span class='text-secondary'>Recibo de Sueldo</span>"))
                        </div>
                        <div class="col">
                            @((Model.TieneVeraz) ?
                                                        Html.Raw("<i class='bi bi-check-circle-fill text-success'></i> <strong>Veraz</strong>") :
                                                        Html.Raw("<i class='bi bi-x-circle text-muted'></i> <span class='text-secondary'>Veraz</span>"))
                        </div>
                        <div class="col">
                            @((Model.TieneImpuesto) ?
                                                        Html.Raw("<i class='bi bi-check-circle-fill text-success'></i> <strong>Impuesto</strong>") :
                                                        Html.Raw("<i class='bi bi-x-circle text-muted'></i> <span class='text-secondary'>Impuesto</span>"))
                        </div>
                        <div class="col">
                            @((Model.TieneServicioLuz) ?
                                                        Html.Raw("<i class='bi bi-check-circle-fill text-success'></i> <strong>Servicio de Luz</strong>") :
                                                        Html.Raw("<i class='bi bi-x-circle text-muted'></i> <span class='text-secondary'>Servicio de Luz</span>"))
                        </div>
                        <div class="col">
                            @((Model.TieneServicioGas) ?
                                                        Html.Raw("<i class='bi bi-check-circle-fill text-success'></i> <strong>Servicio de Gas</strong>") :
                                                        Html.Raw("<i class='bi bi-x-circle text-muted'></i> <span class='text-secondary'>Servicio de Gas</span>"))
                        </div>
                        <div class="col">
                            @((Model.TieneServicioAgua) ?
                                                        Html.Raw("<i class='bi bi-check-circle-fill text-success'></i> <strong>Servicio de Agua</strong>") :
                                                        Html.Raw("<i class='bi bi-x-circle text-muted'></i> <span class='text-secondary'>Servicio de Agua</span>"))
                        </div>
                    </div>
                </div>
            </div>

            <!-- Observaciones -->
            @if (!string.IsNullOrEmpty(Model.Observaciones))
            {
                <div class="card bg-dark border-secondary shadow-sm mb-3">
                    <div class="card-header bg-light text-dark">
                        <h5 class="mb-0"><i class="bi bi-chat-text"></i> Observaciones</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-secondary">@Model.Observaciones</p>
                    </div>
                </div>
            }

            <!-- Auditoría -->
            <div class="card bg-dark border-secondary shadow-sm mb-4">
                <div class="card-header bg-light text-dark">
                    <h5 class="mb-0"><i class="bi bi-clock-history"></i> Información de Auditoría</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="text-secondary small fw-semibold">Creado</label>
                            <p>
                                @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                @if (!string.IsNullOrEmpty(Model.CreatedBy))
                                {
                                    <span class="text-secondary">por @Model.CreatedBy</span>
                                }
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="text-secondary small fw-semibold">Última Modificación</label>
                            <p>
                                @if (Model.UpdatedAt.HasValue)
                                {
                                    @Model.UpdatedAt.Value.ToString("dd/MM/yyyy HH:mm")
                                    if (!string.IsNullOrEmpty(Model.UpdatedBy))
                                    {
                                        <span class="text-secondary">por @Model.UpdatedBy</span>
                                    }
                                }
                                else
                                {
                                    <span class="text-secondary">-</span>
                                }
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Acciones -->
            <div class="card bg-dark border-secondary shadow-sm mb-4">
                <div class="card-header bg-light text-dark">
                    <h5 class="mb-0"><i class="bi bi-gear"></i> Acciones</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex gap-2 flex-wrap">
                        @if (Model.Activo)
                        {
                            <a asp-controller="Credito" asp-action="Create" asp-route-clienteId="@Model.Id" class="btn btn-success">
                                <i class="bi bi-cash-coin"></i> Solicitar Crédito
                            </a>
                        }
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                        <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger">
                            <i class="bi bi-trash"></i> Eliminar
                        </a>
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Volver al Listado
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        console.log("Cliente Details cargado correctamente");
    </script>
}
