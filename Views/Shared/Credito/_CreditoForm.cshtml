@model TheBuryProject.ViewModels.CreditoViewModel
@{
    var mostrarEvaluacion = ViewData["MostrarEvaluacion"] as bool? ?? false;
}

<div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

<div class="row g-4">
    <div class="col-md-6">
        <h5 class="fw-bold text-secondary border-bottom pb-2 mb-3">
            Datos del Cliente
        </h5>

        <div class="mb-3">
            <label asp-for="ClienteId" class="form-label">Cliente *</label>
            <select asp-for="ClienteId" class="form-select bg-body-secondary text-light border-0" asp-items="ViewBag.Clientes" required>
                <option value="">Seleccione un cliente...</option>
            </select>
            <span asp-validation-for="ClienteId" class="text-danger small"></span>
        </div>

        <div class="form-check form-switch mb-3">
            <input asp-for="RequiereGarante" class="form-check-input" type="checkbox" id="chkRequiereGarante" />
            <label class="form-check-label" for="chkRequiereGarante">Requiere Garante</label>
        </div>

        <div id="garanteField" class="mb-3" style="display:@(Model.RequiereGarante ? "block" : "none")">
            <label asp-for="GaranteId" class="form-label">Garante</label>
            <select asp-for="GaranteId" class="form-select bg-body-secondary text-light border-0" asp-items="ViewBag.Garantes">
                <option value="">Seleccione un garante...</option>
            </select>
            <span asp-validation-for="GaranteId" class="text-danger small"></span>
        </div>
    </div>

    <div class="col-md-6">
        <h5 class="fw-bold text-secondary border-bottom pb-2 mb-3">
            Configuración del Crédito
        </h5>

        <div class="mb-3">
            <label asp-for="MontoSolicitado" class="form-label">Límite del Crédito *</label>
            <div class="input-group">
                <span class="input-group-text bg-secondary text-light border-0">$</span>
                <input asp-for="MontoSolicitado" class="form-control bg-body-secondary text-light border-0" type="number" step="0.01" min="0" required />
            </div>
            <small class="form-text text-muted">Monto total disponible para compras</small>
            <span asp-validation-for="MontoSolicitado" class="text-danger small"></span>
        </div>

        <div class="mb-3">
            <label asp-for="TasaInteres" class="form-label">Tasa de Interés Mensual *</label>
            <div class="input-group">
                <input asp-for="TasaInteres" class="form-control bg-body-secondary text-light border-0" type="number" step="0.01" min="0" max="100" required />
                <span class="input-group-text bg-secondary text-light border-0">%</span>
            </div>
            <small class="form-text text-muted">
                Ejemplo 5,00 = 5 % mensual. Se aplica a todas las compras con cuotas.
            </small>
            <span asp-validation-for="TasaInteres" class="text-danger small"></span>
        </div>
    </div>
</div>

<div class="mt-4">
    <label asp-for="Observaciones" class="form-label">Observaciones</label>
    <textarea asp-for="Observaciones" class="form-control bg-body-secondary text-light border-0" rows="3"
              placeholder="Información adicional sobre esta línea de crédito..."></textarea>
    <span asp-validation-for="Observaciones" class="text-danger small"></span>
</div>

@if (mostrarEvaluacion)
{
    <div id="panelEvaluacion" class="mt-4" style="display: none;">
        <div class="card border-info shadow-sm mb-3">
            <div class="card-header bg-info text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-speedometer2 me-2"></i>
                    Evaluación Automática
                </h5>
            </div>
            <div class="card-body" id="resultadoEvaluacion">
                <div class="text-center py-4">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Evaluando...</span>
                    </div>
                    <p class="text-muted mt-2">Evaluando solicitud...</p>
                </div>
            </div>
        </div>
    </div>
}
