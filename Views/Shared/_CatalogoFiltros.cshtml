@model TheBuryProject.ViewModels.CatalogoUnificadoViewModel

@*
    Partial view reutilizable para filtros del catálogo unificado.
    Incluye: búsqueda, categoría, marca, lista de precios, opciones y ordenamiento.
*@

<div class="card bg-dark border-0 shadow-sm mb-4">
    <div class="card-header bg-secondary text-light border-0">
        <button class="btn btn-link text-decoration-none text-light w-100 text-start p-0"
                type="button" data-bs-toggle="collapse" data-bs-target="#catalogoFiltrosCollapse"
                aria-expanded="@(Model.TieneFiltrosActivos ? "true" : "false")">
            <div class="d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-funnel me-2"></i>Búsqueda y Filtros
                    @if (Model.TieneFiltrosActivos)
                    {
                        <span class="badge bg-info text-dark ms-2">Filtros activos</span>
                    }
                </h6>
                <i class="bi bi-chevron-down"></i>
            </div>
        </button>
    </div>
    <div class="collapse @(Model.TieneFiltrosActivos ? "show" : "")" id="catalogoFiltrosCollapse">
        <div class="card-body">
            <form asp-controller="Catalogo" asp-action="Index" method="get">
                <div class="row g-3">

                    @* Lista de precios *@
                    <div class="col-12">
                        <div class="alert alert-info bg-info bg-opacity-10 border-info d-flex align-items-center mb-0 py-2">
                            <i class="bi bi-tags me-2"></i>
                            <span class="me-2">Lista de precios:</span>
                            <select asp-for="ListaPrecioId"
                                    class="form-select form-select-sm bg-body-secondary text-light border-0 w-auto"
                                    asp-items="Model.ListasPreciosFiltro"
                                    onchange="this.form.submit()">
                                <option value="">-- Predeterminada --</option>
                            </select>
                        </div>
                    </div>

                    @* Búsqueda por texto *@
                    <div class="col-md-6">
                        <label class="form-label text-light fw-semibold">
                            <i class="bi bi-search me-1"></i>Búsqueda por texto
                        </label>
                        <input type="text"
                               class="form-control bg-body-secondary text-light border-0"
                               asp-for="SearchTerm"
                               placeholder="Buscar por código, nombre o descripción..." />
                    </div>

                    @* Categoría *@
                    <div class="col-md-3">
                        <label class="form-label text-light fw-semibold">
                            <i class="bi bi-tag me-1"></i>Categoría
                        </label>
                        <select asp-for="CategoriaId"
                                class="form-select bg-body-secondary text-light border-0"
                                asp-items="Model.CategoriasFiltro">
                            <option value="">Todas las categorías</option>
                        </select>
                    </div>

                    @* Marca *@
                    <div class="col-md-3">
                        <label class="form-label text-light fw-semibold">
                            <i class="bi bi-award me-1"></i>Marca
                        </label>
                        <select asp-for="MarcaId"
                                class="form-select bg-body-secondary text-light border-0"
                                asp-items="Model.MarcasFiltro">
                            <option value="">Todas las marcas</option>
                        </select>
                    </div>

                    @* Opciones *@
                    <div class="col-md-6">
                        <label class="form-label text-light fw-semibold">Opciones</label>
                        <div class="d-flex gap-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox"
                                       asp-for="StockBajo" id="stockBajo" value="true" />
                                <label class="form-check-label text-light" for="stockBajo">
                                    <i class="bi bi-exclamation-triangle text-warning me-1"></i>Solo stock bajo
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox"
                                       asp-for="SoloActivos" id="soloActivos" value="true" />
                                <label class="form-check-label text-light" for="soloActivos">
                                    <i class="bi bi-check-circle text-success me-1"></i>Solo activos
                                </label>
                            </div>
                        </div>
                    </div>

                    @* Ordenamiento *@
                    <div class="col-md-3">
                        <label class="form-label text-light fw-semibold">
                            <i class="bi bi-sort-down me-1"></i>Ordenar por
                        </label>
                        <select class="form-select bg-body-secondary text-light border-0" asp-for="OrderBy">
                            <option value="nombre" selected="@(Model.OrderBy == "nombre" || string.IsNullOrEmpty(Model.OrderBy))">Nombre</option>
                            <option value="codigo" selected="@(Model.OrderBy == "codigo")">Código</option>
                            <option value="precioventa" selected="@(Model.OrderBy == "precioventa")">Precio Venta</option>
                            <option value="stock" selected="@(Model.OrderBy == "stock")">Stock</option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-light fw-semibold">Dirección</label>
                        <select class="form-select bg-body-secondary text-light border-0" asp-for="OrderDirection">
                            <option value="asc" selected="@(Model.OrderDirection == "asc" || string.IsNullOrEmpty(Model.OrderDirection))">Ascendente</option>
                            <option value="desc" selected="@(Model.OrderDirection == "desc")">Descendente</option>
                        </select>
                    </div>

                    @* Botones *@
                    <div class="col-12">
                        <div class="d-flex gap-2 mt-2">
                            <button type="submit" class="btn btn-primary fw-semibold">
                                <i class="bi bi-search me-2"></i>Buscar
                            </button>
                            <a asp-controller="Catalogo" asp-action="Index" class="btn btn-outline-light">
                                <i class="bi bi-x-circle me-2"></i>Limpiar filtros
                            </a>
                        </div>
                    </div>

                </div>
            </form>
        </div>
    </div>
</div>
