@model TheBuryProject.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="bi bi-speedometer2"></i> Dashboard - Panel de Control
            </h2>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="row g-3 mb-4">
        <!-- Ventas del Mes -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-primary border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Ventas del Mes</h6>
                            <h3 class="mb-0">@Model.VentasTotalesMes.ToString("C")</h3>
                            <small class="text-muted">@Model.CantidadVentasMes ventas realizadas</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-cart-check fs-1 text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Créditos Activos -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-success border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Créditos Activos</h6>
                            <h3 class="mb-0">@Model.CreditosActivos</h3>
                            <small class="text-muted">Monto total: @(Model.MontoTotalCreditos?.ToString("C") ?? "$0.00")</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-credit-card fs-1 text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clientes -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-info border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Clientes</h6>
                            <h3 class="mb-0">@Model.TotalClientes</h3>
                            <small class="text-muted">Nuevos este mes: @Model.ClientesNuevosMes</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-people fs-1 text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stock Bajo -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-warning border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Stock Bajo</h6>
                            <h3 class="mb-0">@Model.ProductosStockBajo</h3>
                            <small class="text-muted">Productos bajo mínimo</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-exclamation-triangle fs-1 text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alertas de Cobranza -->
    <div class="row g-3 mb-4">
        <!-- Cuotas Vencidas -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-danger border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Cuotas Vencidas</h6>
                            <h3 class="mb-0 text-danger">@Model.CuotasVencidasTotal</h3>
                            <small class="text-danger">@Model.MontoVencidoTotal.ToString("C") pendiente</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-exclamation-circle fs-1 text-danger"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cuotas Por Vencer -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-warning border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Vencen próx. 7 días</h6>
                            <h3 class="mb-0 text-warning">@Model.CuotasProximasVencerCount</h3>
                            <small class="text-muted">@Model.MontoCuotasProximasVencer.ToString("C") a cobrar</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-clock-history fs-1 text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasa Morosidad -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start @(Model.TasaMorosidad > 20 ? "border-danger" : Model.TasaMorosidad > 10 ? "border-warning" : "border-success") border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Tasa Morosidad</h6>
                            <h3 class="mb-0 @(Model.TasaMorosidad > 20 ? "text-danger" : Model.TasaMorosidad > 10 ? "text-warning" : "text-success")">
                                @Model.TasaMorosidad.ToString("N1")%
                            </h3>
                            <small class="text-muted">Cuotas vencidas / pendientes</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-graph-down fs-1 @(Model.TasaMorosidad > 20 ? "text-danger" : Model.TasaMorosidad > 10 ? "text-warning" : "text-success")"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cobranza del Mes -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-start border-success border-4 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="text-muted text-uppercase mb-2">Cobranza del Mes</h6>
                            <h3 class="mb-0 text-success">@Model.CobranzaMes.ToString("C")</h3>
                            <small class="text-muted">Efectividad: @Model.EfectividadCobranza.ToString("N1")%</small>
                        </div>
                        <div class="ms-3">
                            <i class="bi bi-cash-stack fs-1 text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tablas de Alertas -->
    <div class="row g-4 mb-4">
        <!-- Cuotas Vencidas -->
        @if (Model.CuotasVencidasLista.Any())
        {
            <div class="col-lg-6">
                <div class="card shadow-sm border-danger">
                    <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-exclamation-triangle me-2"></i>Cuotas Vencidas (@Model.CuotasVencidasLista.Count)
                        </h5>
                        <a asp-controller="Credito" asp-action="CuotasVencidas" class="btn btn-sm btn-outline-light">Ver todas</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>Cliente</th>
                                        <th class="text-center">Cuota</th>
                                        <th class="text-center">Días</th>
                                        <th class="text-end">Monto</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var cuota in Model.CuotasVencidasLista.Take(10))
                                    {
                                        <tr>
                                            <td>
                                                <a asp-controller="Cliente" asp-action="Details" asp-route-id="@cuota.ClienteId" class="text-decoration-none">
                                                    @cuota.ClienteNombre
                                                </a>
                                            </td>
                                            <td class="text-center">
                                                <span class="badge bg-secondary">#@cuota.NumeroCuota</span>
                                            </td>
                                            <td class="text-center">
                                                <span class="badge @(cuota.DiasVencidos > 30 ? "bg-danger" : cuota.DiasVencidos > 15 ? "bg-warning text-dark" : "bg-secondary")">
                                                    @cuota.DiasVencidos días
                                                </span>
                                            </td>
                                            <td class="text-end fw-semibold text-danger">@cuota.Monto.ToString("C")</td>
                                            <td class="text-end">
                                                <a asp-controller="Credito" asp-action="PagarCuota" asp-route-id="@cuota.CreditoId" asp-route-cuotaId="@cuota.CuotaId" 
                                                   class="btn btn-sm btn-outline-success" title="Registrar pago">
                                                    <i class="bi bi-cash"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Cuotas Próximas a Vencer -->
        @if (Model.CuotasProximasVencer.Any())
        {
            <div class="col-lg-6">
                <div class="card shadow-sm border-warning">
                    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock me-2"></i>Próximas a Vencer (@Model.CuotasProximasVencer.Count)
                        </h5>
                        <span class="badge bg-dark">Próximos 7 días</span>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>Cliente</th>
                                        <th class="text-center">Cuota</th>
                                        <th class="text-center">Vence</th>
                                        <th class="text-end">Monto</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var cuota in Model.CuotasProximasVencer.Take(10))
                                    {
                                        <tr>
                                            <td>
                                                <a asp-controller="Cliente" asp-action="Details" asp-route-id="@cuota.ClienteId" class="text-decoration-none">
                                                    @cuota.ClienteNombre
                                                </a>
                                            </td>
                                            <td class="text-center">
                                                <span class="badge bg-secondary">#@cuota.NumeroCuota</span>
                                            </td>
                                            <td class="text-center">
                                                @if (cuota.DiasParaVencer == 0)
                                                {
                                                    <span class="badge bg-danger">HOY</span>
                                                }
                                                else if (cuota.DiasParaVencer == 1)
                                                {
                                                    <span class="badge bg-warning text-dark">Mañana</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-info">@cuota.DiasParaVencer días</span>
                                                }
                                            </td>
                                            <td class="text-end fw-semibold">@cuota.Monto.ToString("C")</td>
                                            <td class="text-end">
                                                <a asp-controller="Credito" asp-action="PagarCuota" asp-route-id="@cuota.CreditoId" asp-route-cuotaId="@cuota.CuotaId" 
                                                   class="btn btn-sm btn-outline-success" title="Registrar pago">
                                                    <i class="bi bi-cash"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Accesos Rápidos -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-grid-3x3-gap"></i> Accesos Rápidos
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <!-- Ventas -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Venta" asp-action="Create" class="btn btn-outline-primary w-100 py-3 text-start">
                                <i class="bi bi-cart-plus fs-4 d-block mb-2"></i>
                                <strong>Nueva Venta</strong>
                            </a>
                        </div>

                        <!-- Clientes -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Cliente" asp-action="Index" class="btn btn-outline-info w-100 py-3 text-start">
                                <i class="bi bi-people fs-4 d-block mb-2"></i>
                                <strong>Clientes</strong>
                            </a>
                        </div>

                        <!-- Créditos -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Credito" asp-action="Index" class="btn btn-outline-success w-100 py-3 text-start">
                                <i class="bi bi-credit-card fs-4 d-block mb-2"></i>
                                <strong>Créditos</strong>
                            </a>
                        </div>

                        <!-- Productos -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Catalogo" asp-action="Index" class="btn btn-outline-secondary w-100 py-3 text-start">
                                <i class="bi bi-box-seam fs-4 d-block mb-2"></i>
                                <strong>Catálogo</strong>
                            </a>
                        </div>

                        <!-- Proveedores -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Proveedor" asp-action="Index" class="btn btn-outline-primary w-100 py-3 text-start">
                                <i class="bi bi-building fs-4 d-block mb-2"></i>
                                <strong>Proveedores</strong>
                            </a>
                        </div>

                        <!-- Órdenes de Compra -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="OrdenCompra" asp-action="Index" class="btn btn-outline-primary w-100 py-3 text-start">
                                <i class="bi bi-file-earmark-text fs-4 d-block mb-2"></i>
                                <strong>Órdenes Compra</strong>
                            </a>
                        </div>

                        <!-- Stock -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="MovimientoStock" asp-action="Index" class="btn btn-outline-warning w-100 py-3 text-start">
                                <i class="bi bi-truck fs-4 d-block mb-2"></i>
                                <strong>Movimientos Stock</strong>
                            </a>
                        </div>

                        <!-- Cheques -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Cheque" asp-action="Index" class="btn btn-outline-danger w-100 py-3 text-start">
                                <i class="bi bi-cash-coin fs-4 d-block mb-2"></i>
                                <strong>Cheques</strong>
                            </a>
                        </div>

                        <!-- Mora -->
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <a asp-controller="Mora" asp-action="Index" class="btn btn-outline-danger w-100 py-3 text-start">
                                <i class="bi bi-exclamation-circle fs-4 d-block mb-2"></i>
                                <strong>Gestión de Mora</strong>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>